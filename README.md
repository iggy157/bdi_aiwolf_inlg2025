# aiwolf-nlp-agent-llm

[README in English](/README.en.md)

人狼知能コンテスト（自然言語部門） のLLMを用いたサンプルエージェントです。

## 環境構築

> [!IMPORTANT]
> Python 3.11以上が必要です。

```bash
git clone https://github.com/aiwolfdial/aiwolf-nlp-agent-llm.git
cd aiwolf-nlp-agent-llm
cp config/.env.example config/.env
python -m venv .venv
source .venv/bin/activate
pip install -e .
```

### 日本語のプロンプトを使用したい場合
```bash
cp config/config.jp.yml.example config/config.yml
```

### 英語のプロンプトを使用したい場合
```bash
cp config/config.en.yml.example config/config.yml
```

## その他

実行方法や設定などその他については[aiwolf-nlp-agent](https://github.com/aiwolfdial/aiwolf-nlp-agent)をご確認ください。

## サーバー起動
### 🐧 Linux

```bash
curl -LO https://github.com/aiwolfdial/aiwolf-nlp-server/releases/latest/download/aiwolf-nlp-server-linux-amd64
curl -LO https://github.com/aiwolfdial/aiwolf-nlp-server/releases/latest/download/default_5.yml
curl -LO https://github.com/aiwolfdial/aiwolf-nlp-server/releases/latest/download/default_13.yml
curl -Lo .env https://github.com/aiwolfdial/aiwolf-nlp-server/releases/latest/download/example.env
chmod u+x ./aiwolf-nlp-server-linux-amd64
./aiwolf-nlp-server-linux-amd64 -c ./default_5.yml # 5人ゲーム
# ./aiwolf-nlp-server-linux-amd64 -c ./default_13.yml # 13人ゲーム
```

## ビュアー起動

```bash
cd aiwolf-nlp-viewer/
pnpm run dev --open
```

## 分析ツール

### extract_pairs - 発話者別ペア抽出

ゲーム分析結果から発話者（from）ごとに content と credibility のペアを抽出し、整理して保存するツールです。

#### 使用方法

```bash
# 指定ゲームの全エージェントを処理
python -m utils.bdi.micro_bdi.extract_pairs --game-id 01TESTGAMEID

# 特定のエージェントのみ処理
python -m utils.bdi.micro_bdi.extract_pairs --game-id 01TESTGAMEID --agent メイ --agent サクラ

# pending分析エントリを除外
python -m utils.bdi.micro_bdi.extract_pairs --game-id 01TESTGAMEID --skip-pending

# 詳細ログを表示
python -m utils.bdi.micro_bdi.extract_pairs --game-id 01TESTGAMEID --verbose
```

#### 機能

- `analysis.yml` (なければ `analysis_test.yml`) を自動読み込み
- `credibility` / `creditability` のスペルゆらぎに対応
- `from` が null/空の場合は `unknown` フォルダに分類
- 日本語フォルダ名に対応
- 冪等性保証（再実行安全）

#### 出力形式

```
info/bdi_info/micro_bdi/<game_id>/<agent>/pairs_by_from/
  ├── アスカ/pairs.yml
  ├── シズエ/pairs.yml
  └── unknown/pairs.yml
```

各 `pairs.yml` の内容例：
```yaml
# generated by utils.bdi.micro_bdi.extract_pairs
count: 2
items:
  - content: 占いCOの有無を確認したいです。
    credibility: 0.66
  - content: 仮投票先と理由をお願いします。
    credibility: 0.45
```